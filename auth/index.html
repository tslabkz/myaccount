<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>INSPINIA | Main page</title>

    <base href="../">

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="css/plugins/ladda/ladda-themeless.min.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">

</head>

<body class="">

    <div id="wrapper">

    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                
                
                <li class="nav-header">
                    <div class="dropdown profile-element">
                        
                        <a href="auth/index.html">
                            <span class="block m-t-xs font-bold">My Account</span>
                        </a>
                        
                    </div>
                    <div class="logo-element">
                        MY+
                    </div>
                </li>


                <li>
                    <a href="grid_options.html"><i class="fa fa-laptop"></i> <span class="nav-label">Grid options</span></a>
                </li>
               
                <li>
                    <a href="#"><i class="fa fa-sitemap"></i> <span class="nav-label">Menu Levels </span><span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level collapse">
                        <li>
                            <a href="#">Third Level <span class="fa arrow"></span></a>
                            <ul class="nav nav-third-level">
                                <li>
                                    <a href="#">Third Level Item</a>
                                </li>
                                <li>
                                    <a href="#">Third Level Item</a>
                                </li>
                                <li>
                                    <a href="#">Third Level Item</a>
                                </li>

                            </ul>
                        </li>
                        <li><a href="#">Second Level Item</a></li>
                        <li>
                            <a href="#">Second Level Item</a></li>
                        <li>
                            <a href="#">Second Level Item</a></li>
                    </ul>
                </li>

            </ul>

        </div>
    </nav>

        <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
        <nav class="navbar navbar-static-top  " role="navigation" style="margin-bottom: 0">

        <div class="navbar-header">
            <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>
        </div>

            <ul class="nav navbar-top-links navbar-right">
                <li>
                    <span class="m-r-sm text-muted welcome-message">Добро пожаловать в проект MyAccount.</span>
                </li>
                <li>
                    <a href="index.html" id="logout-link-el">
                        <i class="fa fa-sign-out"></i> Log out
                    </a>
                </li>
            </ul>

        </nav>
        </div>
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-sm-12">
                    <h2>Проект MyAccount</h2>
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="auth/index.html">Страница</a>
                        </li>
                        <li class="breadcrumb-item active">
                            <strong>Профиль</strong>
                        </li>
                    </ol>
                </div> 
            </div>

            <div class="wrapper wrapper-content">
                <div class="animated fadeInRightBig">
                    <!-- content:start -->
                    <div class="row">
                        <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                            <!-- first column:start -->
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <h5>Профиль <small class="m-l-sm">Персональные данные</small></h5>
                                    <div class="ibox-tools">
                                        <span id="status-label-el"></span>

                                        <a class="collapse-link">
                                            <i class="fa fa-chevron-up"></i>
                                        </a> 
                                    </div>
                                </div>
                                <div class="ibox-content">
                                    
                                    <table class="table" id="profile-data-table" >
                                        <thead>
                                        <tr>
                                            <th>Поле</th>
                                            <th>Значение</th>
                                            <th>Примечание</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>Имя</td>
                                            <td>Otto</td>
                                            <td>@mdo</td>
                                        </tr>
                                        <tr>
                                            <td>Фамилия</td>
                                            <td>Thornton</td>
                                            <td>@fat</td>
                                        </tr>
                                        <tr>
                                            <td>Отчество</td>
                                            <td>the Bird</td>
                                            <td>@twitter</td>
                                        </tr>                                
                                        <tr>
                                            <td>ИНН</td>
                                            <td>the Bird</td>
                                            <td>@twitter</td>
                                        </tr>
                                        </tbody>
                                    </table>
        
                                </div>
                                
                            </div>
                            <!-- first column:end -->
                        </div>
                        <div class="col-md-6 col-lg-6 col-sm-12 col-xs-12">
                            <!-- second column:start -->
                            <div class="ibox ">
                                <div class="ibox-title">
                                    <h5>Аккаунт <small class="m-l-sm">Идентификационные данные</small></h5>
                                    <div class="ibox-tools">
                                        <span id="account-status-label-el"></span>
                                        <a class="collapse-link">
                                            <i class="fa fa-chevron-up"></i>
                                        </a> 
                                    </div>
                                </div>
                                <div class="ibox-content">
                                    
                                    <table class="table"  id="account-data-table">
                                        <thead>
                                        <tr>
                                            <th>Поле</th>
                                            <th>Значение</th>
                                            <th>Примечание</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Инн</td>
                                                <td></td>
                                                <td><span class="text-danger">Не указан</span></td>
                                            </tr> 
                                        <tr>
                                            <td>Телефон</td>
                                            <td>87025687896</td>
                                            <td><span class="text-success">Подтвержден</span></td>
                                        </tr>
                                        <tr>
                                            <td>Эл почта</td>
                                            <td>erfdgd@mail.ru</td>
                                            <td><span class="label label-warning">Не подтвержден</span></td>
                                        </tr>                               
                                        <tr>
                                            <td>Логин</td>
                                            <td>someuser</td>
                                            <td></td>
                                        </tr>
                                        </tbody>
                                    </table>
        
                                </div>
                                


                                <div class="ibox-footer">
                                    <!-- <span class="float-right">
                                      The righ side of the footer
                                    </span> -->
                                    
                                <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#editAuthFormModal">
                                    Редактировать
                                </button>
                                    <!-- modal start -->
                                    <div class="modal inmodal fade" id="editAuthFormModal" tabindex="-1" role="dialog"  aria-hidden="true">
                                        <div class="modal-dialog modal-md">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                                    <h4 class="modal-title">Форма данных авторизации</h4>
                                                    <small class="font-bold">Здесь вы можете изменить авторизационные данные, такие как телефон эл почту и тд.</small>
                                                </div>
                                                <div class="modal-body">

                                                    <div class="form-group  row">
                                                        <label class="col-sm-4 col-form-label">Телефон</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="auth-form-phone">
                                                            <span class="form-text m-b-none">После изменения номера телефона необходимо подтвердить, что бы им пользоваться.</span>
                                                        </div>
                                                    </div>

                                                    <div class="form-group  row">
                                                        <label class="col-sm-4 col-form-label">Эл почта</label>
                                                        <div class="col-sm-8">
                                                            <input type="text" class="form-control" name="auth-form-email" >
                                                            <span class="form-text m-b-none">После изменения эл почты необходимо подтвердить, что бы им пользоваться.</span>
                                                        </div>
                                                    </div>

                                                    <div class="form-group  row">
                                                        <label class="col-sm-4 col-form-label">Логин</label>
                                                        <div class="col-sm-8"><input type="text" class="form-control" name="auth-form-login" ></div>
                                                    </div>

                                                    <div class="form-group  row">
                                                        <label class="col-sm-4 col-form-label">Пароль</label>
                                                        <div class="col-sm-8"><input type="text" class="form-control" name="auth-form-new_password" ></div>
                                                    </div>

                   

                                                </div>
        
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-white" data-dismiss="modal">Закрыть</button>
                                                    <!-- <button type="button" class="btn btn-primary">Сохранить</button> -->
                                                    <button class="ladda-button btn btn-primary" data-style="expand-left" id="auth-data-form-submit">
                                                        <span class="ladda-label">Сохранить</span><span class="ladda-spinner"></span>
                                                        <div class="ladda-progress" style="width: 0px;"></div>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- modal end -->


                                </div>



                            </div>
                            <!-- second column:end -->
                        </div>
                    </div>

                    
                    <!-- content:end --> 
                </div>
            </div>

            <div class="footer">
                <div class="float-right">
                    10GB of <strong>250GB</strong> Free.
                </div>
                <div>
                    <strong>Copyright</strong> Example Company &copy; 2014-2018
                </div>
            </div>

        </div>
        </div>

    <!-- Mainly scripts -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="js/inspinia.js"></script>
    <script src="js/plugins/pace/pace.min.js"></script>
     
    <!-- Ladda -->
    <script src="js/plugins/ladda/spin.min.js"></script>
    <script src="js/plugins/ladda/ladda.min.js"></script>
    <script src="js/plugins/ladda/ladda.jquery.min.js"></script>

    <script src="js/project.js"></script>
    <script type="text/javascript">

    $(document).ready(function(){

        // var l = $( '.ladda-button' ).ladda();

        // l.click(function(){
        //     // Start loading
        //     l.ladda( 'start' );

        //     // Timeout example
        //     // Do something in backend and then stop ladda
        //     setTimeout(function(){
        //         l.ladda('stop');
        //     },12000)


        // });
        //--------------------------------------------
        $("#auth-data-form-submit").click(function(event){
            event.preventDefault();
            // service_id(string, обязателен), uuid(string, обязателен), phone(string), email(string), login(string), new_password(string)
        });

        $("#auth-data-form-submit").click(function(e){
            var l = Ladda.create(this);
	 	    l.start();

            e.preventDefault();
            // $("#submit-form-btn").attr("disabled", '1');
            // $("#alert-process-is-on").show();
            // register_email
            var data = {};
            let authData = project.auth.getData().account;
            data['uuid'] = authData.uuid;
            if ($("input[name=auth-form-email]").val().length > 0) {
                data['email'] = $("input[name=auth-form-email]").val();
            }

            if ($("input[name=auth-form-phone]").val().length > 0) {
                data['phone'] = $("input[name=auth-form-phone]").val();
            }

            if ($("input[name=auth-form-login]").val().length > 0) {
                data['login'] = $("input[name=auth-form-login]").val();
            }

            if ($("input[name=auth-form-new_password]").val().length > 0) { 
                data['new_password'] = $("input[name=auth-form-new_password]").val();
            }

            let url = project.buildUrl('user.editAuthForm', data);

            $.get(url, function(response) { 
                if (response.success) { 
                    authData = project.auth.getData(); 
                    Object.keys(response.data).forEach(function(editedProp) { 
                        authData.account[editedProp] = response.data[editedProp]; 
                    }); 
                    project.auth.setData(authData); 
                    window.location.reload();  
                } else {
                    // // error
                    // let message = "";
                    // // message = message + "<br /><strong>" + response.message + '</strong>';
                    // if (response.errors.length > 0) {
                    //     // message = message + "<ul>";
                    //     response.errors.forEach(function(errorMessage){
                    //         message = message + "<br><strong>" + errorMessage + "</strong>";
                    //     });
                    //     // message = message + "</ul>";
                    // }
                    // showErrorAlert(message);
                }

            })
            .fail(function(response) {
                // showErrorAlert('');
                console.log("failed");
            })
            .always(function() {
                console.log("always function fired");
                l.stop(); 
                // $("#alert-process-is-on").hide();
                // $("#submit-form-btn").removeAttr("disabled");
            }); 
        });
        //--------------------------------------------
        if (!project.auth.isLogged()) {
            window.location = 'index.html';
        }
        $("#logout-link-el").click(function(event){
            event.preventDefault();
            project.auth.logOut();
            window.location = 'index.html';
        });
        //--------------------------------------------
        // заполняем профильные данные
        // profile-data-table
        $("#profile-data-table tbody").html("");
        let appendTrHtml = "";
        let authData = project.auth.getData();
        let profileData = authData.profile;
        
        let nameTemplate = '<tr>' +
                        '<td>Имя</td>' + 
                        '<td>%name%</td>' + 
                        '<td></td>' + 
                        '</tr>';
        let nameHtml = nameTemplate.replace('%name%', profileData.name);
        $("#profile-data-table tbody").append(nameHtml);
        
        let surnameHtml = '<tr>' +
                        '<td>Фамилия</td>' + 
                        '<td>%surname%</td>' + 
                        '<td></td>' + 
                        '</tr>';
        appendTrHtml = surnameHtml.replace('%surname%', profileData.surname);
        $("#profile-data-table tbody").append(appendTrHtml);

        let lastnameHtml = '<tr>' +
                        '<td>Отчество</td>' + 
                        '<td>%lastname%</td>' + 
                        '<td></td>' + 
                        '</tr>';
        appendTrHtml = lastnameHtml.replace('%lastname%', profileData.lastname);
        $("#profile-data-table tbody").append(appendTrHtml);

        let birthdateHtml = '<tr>' +
                        '<td>День рождения</td>' + 
                        '<td>%birthdate%</td>' + 
                        '<td></td>' + 
                        '</tr>';
        let bDataStr = '';
        if (profileData.birthdate.length > 0)  {
            if (profileData.birthdate.length > 10) {
                let bDate = new Date(profileData.birthdate);
                bDataStr = bDate.getDate() + '-' + bDate.getUTCMonth() + '-' + bDate.getFullYear();
            } else {
                bDataStr = profileData.birthdate;
            }
        }
        appendTrHtml = birthdateHtml.replace('%birthdate%', bDataStr);
        $("#profile-data-table tbody").append(appendTrHtml);
        
        let genderHtml = '<tr>' +
                        '<td>Пол</td>' + 
                        '<td>%gender%</td>' + 
                        '<td></td>' + 
                        '</tr>';
        appendTrHtml = genderHtml.replace('%gender%', profileData.gender);
        $("#profile-data-table tbody").append(appendTrHtml);
        let profileStatusHtml = '<span class="label label-warning-light">Пустой</span>';
        if (profileData.status == 'filled') {
            profileStatusHtml = '<span class="label label-info">Заполенен</span>';
        }
        if (profileData.status == 'confirmed') {
            profileStatusHtml = '<span class="label label-primary">Подтвержден</span>';
        } 
        $("#status-label-el").html(profileStatusHtml);
        //--------------------------------------------
        $("#account-data-table tbody").html("");
        appendTrHtml = "";
        htmlTemplate = "";
        editedHtml = "";
        let account = profileData = authData.account;
        //-------
        // account-status-label-el
        let accountStatusHtml = '<span class="label label-warning-light">inactive</span>';
        if (profileData.status == 'active') {
            accountStatusHtml = '<span class="label label-primary">Активен</span>';
        } 
        $("#account-status-label-el").html(accountStatusHtml);
        //-------
        htmlTemplate = '<tr>' +
                        '<td>ИНН</td>' + 
                        '<td>%iin%</td>' + 
                        '<td>%status%</td>' + 
                        '</tr>';
        editedHtml = htmlTemplate.replace('%iin%', account.iin);
        let iinStatusStr = "";
        if (account.iin_status) {    
            iinStatusStr = "Статус одобрения: " + account.iin_status;
        }
        editedHtml = editedHtml.replace('%status%', iinStatusStr);
        $("#account-data-table tbody").append(editedHtml);
        //---
        htmlTemplate = '<tr>' +
                        '<td>Телефон</td>' + 
                        '<td>%phone%</td>' + 
                        '<td>%status%</td>' + 
                        '</tr>';
        editedHtml = htmlTemplate.replace('%phone%', account.phone);
        let phoneAproved = "";
        if (account.phone.length > 0) {
            phoneAproved = "<span class='text-danger'>Не подтвержден</span>";
            if (account.phone_status == 1) {
                phoneAproved = "<span class='text-success'>Подтвержден</span>";
            }
        }
        editedHtml = editedHtml.replace('%status%', phoneAproved);
        $("#account-data-table tbody").append(editedHtml);
        // -----
        htmlTemplate = '<tr>' +
                        '<td>Email</td>' + 
                        '<td>%email%</td>' + 
                        '<td>%status%</td>' + 
                        '</tr>';
        let emailText = (account.email) ? account.email : '<span class="text-muted" >не указан</span>' ;
        editedHtml = htmlTemplate.replace('%email%', emailText);
        let emailAproved = "";
        if (account.email.length > 0) {
            emailAproved = "<span class='text-danger'>Не подтвержден</span>";
            if (account.email_status == 1) {
                emailAproved = "<span class='text-success'>Подтвержден</span>";
            }
        }
        editedHtml = editedHtml.replace('%status%', emailAproved);
        $("#account-data-table tbody").append(editedHtml);
        // -----
        htmlTemplate = '<tr>' +
                        '<td>Login</td>' + 
                        '<td>%login%</td>' + 
                        '<td></td>' + 
                        '</tr>';
        let loginText = (account.login) ? account.login : '<span class="text-muted" >не указан</span>' ;
        editedHtml = htmlTemplate.replace('%login%', loginText); 
        $("#account-data-table tbody").append(editedHtml);
        /*
        // 980611407147
        */
    });

    </script>

</body>

</html>
